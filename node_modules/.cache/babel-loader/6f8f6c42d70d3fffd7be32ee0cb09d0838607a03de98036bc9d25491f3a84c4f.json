{"ast":null,"code":"import { reactive, getCurrentInstance, toRefs } from 'vue';\nexport default {\n  setup() {\n    const user = reactive({\n      id: 0,\n      account: \"\",\n      name_alias: \"\",\n      mail: \"\",\n      phone: \"\"\n    });\n    const updateUserRef = ref();\n    const rules = {\n      account: [{\n        required: true,\n        message: '用户名不能为空',\n        trigger: 'blur'\n      }, {\n        pattern: /^[a-zA-Z0-9]{1,10}$/,\n        message: '英文字母（a-z,A-Z）、数字(0-9)，长度为1-10位',\n        trigger: 'blur'\n      }],\n      phone: [{\n        pattern: /^[1][0-9]{10}$/,\n        message: '请输入正确手机号码',\n        trigger: 'blur'\n      }],\n      password: [{\n        required: true,\n        message: '密码不能为空',\n        trigger: 'blur'\n      }, {\n        pattern: /^.*(?=.{6,16})(?=.*\\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$/,\n        message: '至少包括1个大写字母，1个小写字母，1个数字，1个特殊字符,长度为6-16位',\n        trigger: 'blur'\n      }],\n      re_password: [{\n        required: true,\n        message: '密码不能为空',\n        trigger: 'blur'\n      }, {\n        validator: function (rule, value, callback) {\n          console.log(value);\n          if (value !== user.password) {\n            callback(new Error('两次输入的密码必须相同'));\n          }\n          return true;\n        },\n        trigger: 'blur'\n      }],\n      mail: [{\n        pattern: /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/,\n        message: '请输入正确邮箱地址',\n        trigger: 'blur'\n      }]\n    };\n    const config = reactive({\n      centerDialogVisible: false,\n      isLoading: false\n    });\n    const {\n      proxy\n    } = getCurrentInstance();\n    const updateUser = async () => {\n      const obj = {\n        id: user.id,\n        name_alias: user.name_alias,\n        mail: user.mail,\n        phone: user.phone\n      };\n      await updateUserRef.validate((valid, fields) => {\n        if (valid) {\n          config.isLoading = true;\n          new proxy.$request(proxy.$urls.m().userupdate, obj).modepost().then(rest => {\n            if (rest.data.code !== 200) {\n              new proxy.$tips(\"更新用户失败，稍后重试\", \"error\").notify();\n            }\n            config.isLoading = false;\n            config.centerDialogVisible = false;\n            proxy.$emit('flushPage');\n          }).catch();\n        }\n      });\n    };\n\n    // 被父组件user.vue调用\n    function updateUserDialog(userDetail) {\n      config.centerDialogVisible = true;\n      user.id = userDetail.id;\n      user.account = userDetail.username;\n      user.name_alias = userDetail.name_alias;\n      user.mail = userDetail.mail;\n      user.phone = userDetail.phone;\n      console.log(userDetail);\n    }\n    return {\n      config,\n      updateUser,\n      updateUserDialog,\n      user,\n      addUserRef,\n      rules\n    };\n  }\n};","map":{"version":3,"names":["reactive","getCurrentInstance","toRefs","setup","user","id","account","name_alias","mail","phone","updateUserRef","ref","rules","required","message","trigger","pattern","password","re_password","validator","rule","value","callback","console","log","Error","config","centerDialogVisible","isLoading","proxy","updateUser","obj","validate","valid","fields","$request","$urls","m","userupdate","modepost","then","rest","data","code","$tips","notify","$emit","catch","updateUserDialog","userDetail","username","addUserRef"],"sources":["D:\\src\\github.com\\SecurityNeo\\cmdb-ui\\src\\page\\system\\components\\updateuser-dialog.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-dialog\r\n            v-model=config.centerDialogVisible\r\n            title=\"编辑用户\"\r\n            width=\"30%\"\r\n            align-center\r\n            :close-on-click-modal=\"false\"            \r\n        >\r\n        <div>\r\n            <div style=\"margin-right: 72px\">\r\n                <el-form\r\n                    ref=\"updateUserRef\"\r\n                    :model=\"user\"\r\n                    :rules=\"rules\"\r\n                    label-width=\"120px\"\r\n                    status-icon\r\n                >\r\n                    <el-form-item label=\"用户名\" prop=\"account\">\r\n                        <el-input v-model=\"user.account\"  clearable class=\"inputflex\"  placeholder=\"请输入用户名（1-10位）\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"姓名\" prop=\"name_alias\">\r\n                        <el-input v-model=\"user.name_alias\" clearable class=\"inputflex\"  placeholder=\"请输入姓名，如不填，则与用户名保持一致\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"密码\" prop=\"password\">\r\n                        <el-input v-model=\"user.password\" clearable class=\"inputflex\" type=\"password\" placeholder=\"请输入密码\" show-password />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"确认密码\" prop=\"re_password\">\r\n                        <el-input v-model=\"user.re_password\" clearable class=\"inputflex\" type=\"password\" placeholder=\"请确认密码\" show-password />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"电子邮箱\" prop=\"mail\">\r\n                        <el-input v-model=\"user.mail\" clearable class=\"inputflex\"  placeholder=\"请输入电子邮箱\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"电话号码\" prop=\"phone\">\r\n                        <el-input v-model=\"user.phone\" clearable class=\"inputflex\"  placeholder=\"请输入电话号码\"  />\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n            <div>         \r\n                <div style=\"float: right; margin-bottom: 40px; margin-right: 72px;margin-top: 20px;\">\r\n                    <el-button @click=\"config.centerDialogVisible = false\">取消</el-button>\r\n                    <el-button type=\"primary\" :loading=\"config.isLoading\" @click=\"addUser(addUserRef)\" >确认</el-button>\r\n                </div>                    \r\n            </div>\r\n        </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {reactive, getCurrentInstance, toRefs} from 'vue'\r\n\r\nexport default {\r\n    setup() {\r\n        const user = reactive({\r\n            id: 0,\r\n            account: \"\",\r\n            name_alias: \"\",\r\n            mail: \"\",\r\n            phone: \"\"\r\n        })\r\n\r\n        const updateUserRef = ref() \r\n        const rules = {\r\n            account: [\r\n                { required: true, message: '用户名不能为空', trigger: 'blur' },\r\n                { pattern: /^[a-zA-Z0-9]{1,10}$/, message: '英文字母（a-z,A-Z）、数字(0-9)，长度为1-10位', trigger: 'blur' }\r\n            ],\r\n            phone: [\r\n                { pattern: /^[1][0-9]{10}$/,message: '请输入正确手机号码',trigger: 'blur'}\r\n            ],\r\n            password: [\r\n                { required: true, message: '密码不能为空', trigger: 'blur' },\r\n                { pattern: /^.*(?=.{6,16})(?=.*\\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$/, message: '至少包括1个大写字母，1个小写字母，1个数字，1个特殊字符,长度为6-16位',trigger: 'blur'}\r\n            ],\r\n            re_password: [\r\n                { required: true, message: '密码不能为空', trigger: 'blur' },\r\n                { \r\n                    validator:  function(rule, value, callback) {\r\n                        console.log(value);\r\n                        if (value !== user.password) {\r\n                            callback( new Error('两次输入的密码必须相同'))\r\n                        }\r\n                        return true\r\n                    },trigger: 'blur'\r\n\t\t\t\t}\r\n            ],\r\n            mail: [\r\n                { pattern: /^([A-Za-z0-9_\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/,message: '请输入正确邮箱地址',trigger: 'blur'}\r\n            ],\r\n        }\r\n\r\n        const config = reactive({\r\n            centerDialogVisible: false,\r\n            isLoading: false\r\n        })\r\n\r\n        const {proxy} = getCurrentInstance()\r\n        const updateUser = async() => {\r\n            const obj = {\r\n                id: user.id,\r\n                name_alias: user.name_alias,\r\n                mail: user.mail,\r\n                phone: user.phone,\r\n            }\r\n            await updateUserRef.validate((valid, fields) => {\r\n                if (valid) {\r\n                    config.isLoading = true\r\n                    new proxy.$request(proxy.$urls.m().userupdate, obj).modepost()\r\n                    .then(rest=>{\r\n                        if (rest.data.code !== 200) {\r\n                            new proxy.$tips(\"更新用户失败，稍后重试\", \"error\").notify()\r\n                        }\r\n                        config.isLoading = false\r\n                        config.centerDialogVisible = false\r\n                        proxy.$emit('flushPage')\r\n                    })\r\n                    .catch()\r\n                    \r\n                }\r\n            })\r\n        }\r\n\r\n        // 被父组件user.vue调用\r\n        function updateUserDialog(userDetail) {\r\n            config.centerDialogVisible = true\r\n            user.id = userDetail.id\r\n            user.account = userDetail.username\r\n            user.name_alias = userDetail.name_alias\r\n            user.mail = userDetail.mail\r\n            user.phone = userDetail.phone\r\n            console.log(userDetail);\r\n        }\r\n\r\n        return {config, updateUser,updateUserDialog, user,addUserRef,rules}\r\n    }\r\n}\r\n\r\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}