{"ast":null,"code":"import \"core-js/modules/web.dom-exception.stack.js\";\nimport { Terminal } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport 'xterm/css/xterm.css';\nimport { debounce } from 'lodash';\nimport { getCurrentInstance, reactive, onBeforeUnmount, onUnmounted, onMounted, toRefs, ref } from 'vue';\nimport { useRoute } from 'vue-router';\nexport default {\n  setup() {\n    const route = useRoute();\n    const terminal = ref();\n    const formRef = ref();\n    const formData = reactive({\n      user: 'root',\n      pwd: '',\n      ip: '',\n      port: '22'\n    });\n    const rules = {\n      ip: [{\n        required: true,\n        message: 'IP地址不能为空',\n        trigger: 'blur'\n      }, {\n        pattern: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n        message: '请输入正确IPV4地址',\n        trigger: 'blur'\n      }],\n      port: [{\n        required: true,\n        message: '端口号不能为空',\n        trigger: 'blur'\n      }, {\n        pattern: /^\\d*\\.?\\d+$/,\n        message: '请输入正确端口号',\n        trigger: 'blur'\n      }],\n      user: [{\n        required: true,\n        message: '用户名不能为空',\n        trigger: 'blur'\n      }],\n      pwd: [{\n        required: true,\n        message: '用户名不能为空',\n        trigger: 'blur'\n      }]\n    };\n    onBeforeUnmount(() => {\n      removeResizeListener();\n      config.term && config.term.dispose();\n      config.ws.send(JSON.stringify({\n        type: 'stdin',\n        data: utf8_to_b64('exit')\n      }));\n    });\n    onUnmounted(() => {\n      config.ws.send(JSON.stringify({\n        type: 'stdin',\n        data: utf8_to_b64('exit')\n      }));\n    });\n    onMounted(() => {\n      config.source = route.query.source;\n      config.type = route.query.type;\n      config.id = route.query.id;\n      if (config.source === 'plat') {\n        if (config.type === 'vm') {\n          // 调用虚拟机详情接口查询登录信息\n          getVmDetail();\n          console.log(formData);\n          // 跳转过来不用再校验，直接登录\n          // config.isLoading = true\n          // initWs()    \n        } else if (config.type === 'server') {\n          // 调用物理机详情接口查询登录信息\n          getServerDetail();\n          // 跳转过来不用再校验，直接登录\n          config.isLoading = true;\n          initWs();\n        }\n      }\n    });\n    const {\n      proxy\n    } = getCurrentInstance();\n    const packResize = (cols, rows) => JSON.stringify({\n      type: 'resize',\n      cols: cols,\n      rows: rows\n    });\n    const config = reactive({\n      id: 0,\n      source: 'other',\n      type: '',\n      isLoading: false,\n      initText: '正在努力连接中...\\r\\n',\n      first: true,\n      term: null,\n      fitAddon: null,\n      ws: null,\n      socketUrl: proxy.$urls.m().ws,\n      option: {\n        lineHeight: 1.0,\n        // 光标闪烁\n        cursorBlink: true,\n        // 光标样式 'block' | 'underline' | 'bar'\n        cursorStyle: 'block',\n        // 字体大小\n        fontSize: 15,\n        // fontcolor: '#000000',\n        fontFamily: \"Monaco, Menlo, Consolas, 'Courier New', monospace\",\n        theme: {\n          // 背景色\n          background: '#002833',\n          // 前景色\n          foreground: '#14e264',\n          // 光标背景色\n          cursor: 'help',\n          // 光标前景色\n          /** The accent color of the cursor (fg color for a block cursor) */\n          // cursorAccent: '#000000',\n          // 选择背景色\n          /** The selection background color (can be transparent) */\n          selection: '#0000ff',\n          // 选择前景色\n          /** The selection foreground color */\n          selectionForeground: '#0000ff'\n        },\n        cols: 30 // 初始化的时候不要设置fit，设置col为较小值（最小为可展示initText初始文字即可）方便屏幕缩放\n      }\n    });\n\n    const initWs = () => {\n      initTerm();\n      initSocket();\n      onTerminalResize();\n      onTerminalKeyPress();\n    };\n    const submitForm = formRef => {\n      //config.activeName = 'second'\n      formRef.validate((valid, fields) => {\n        if (valid) {\n          config.isLoading = true;\n          initWs();\n        }\n      });\n    };\n    const resetForm = formName => {\n      formName.value.resetFields();\n    };\n    const handleClick = (tab, event) => {\n      if (tab.name === 'second') {\n        // this.init()\n      }\n    };\n    function utf8_to_b64(rawString) {\n      return btoa(unescape(encodeURIComponent(rawString)));\n    }\n    function b64_to_utf8(encodeString) {\n      return decodeURIComponent(escape(atob(encodeString)));\n    }\n    function bytesHuman(bytes, precision) {\n      if (!/^([-+])?|(\\.\\d+)(\\d+(\\.\\d+)?|(\\d+\\.)|Infinity)$/.test(bytes)) {\n        return '-';\n      }\n      if (bytes === 0) return '0';\n      if (typeof precision === 'undefined') precision = 1;\n      const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB', 'BB'];\n      const num = Math.floor(Math.log(bytes) / Math.log(1024));\n      const value = (bytes / Math.pow(1024, Math.floor(num))).toFixed(precision);\n      return `${value} ${units[num]}`;\n    }\n    function isWsOpen() {\n      return config.ws && config.ws.readyState === 1;\n    }\n    const initTerm = () => {\n      config.term = new Terminal(config.option);\n      config.fitAddon = new FitAddon();\n      config.term.loadAddon(config.fitAddon);\n      config.term.open(terminal.value);\n      // config.fitAddon.fit() // 初始化的时候不要使用fit\n      setTimeout(() => {\n        config.fitAddon.fit();\n      }, 500); // 必须延时处理\n    };\n\n    function onTerminalKeyPress() {\n      config.term.onData(data => {\n        isWsOpen() && config.ws.send(JSON.stringify({\n          type: 'stdin',\n          data: utf8_to_b64(data)\n        }));\n      });\n    }\n    function resizeRemoteTerminal() {\n      const {\n        cols,\n        rows\n      } = config.term;\n      console.log('列数、行数设置为：', cols, rows);\n      // 调整后端终端大小 使后端与前端终端大小一致\n      isWsOpen() && config.ws.send(packResize(cols, rows));\n    }\n    const onResize = debounce(function () {\n      config.fitAddon.fit();\n    }, 100);\n    function onTerminalResize() {\n      window.addEventListener('resize', onResize);\n      config.term.onResize(resizeRemoteTerminal);\n    }\n    function removeResizeListener() {\n      window.removeEventListener('resize', onResize);\n    }\n    const initSocket = () => {\n      config.term.write(config.initText);\n      console.log(config.socketUrl);\n      config.ws = new WebSocket(config.socketUrl, ['webssh']);\n      onOpenSocket();\n      onCloseSocket();\n      onErrorSocket();\n      config.term._initialized = true;\n      onMessageSocket();\n    };\n    const onOpenSocket = () => {\n      config.ws.onopen = () => {\n        console.log('websocket 已连接');\n        config.ws.send(JSON.stringify({\n          type: \"addr\",\n          data: utf8_to_b64(formData.ip + ':' + formData.port)\n        }));\n        // socket.send(JSON.stringify({ type: \"term\", data: utf8_to_b64(\"linux\") }));\n        config.ws.send(JSON.stringify({\n          type: \"login\",\n          data: utf8_to_b64(formData.user)\n        }));\n        config.ws.send(JSON.stringify({\n          type: \"password\",\n          data: utf8_to_b64(formData.pwd)\n        }));\n        config.term.reset();\n        setTimeout(() => {\n          resizeRemoteTerminal();\n        }, 500);\n      };\n    };\n    const onCloseSocket = () => {\n      config.ws.onclose = () => {\n        console.log('关闭连接');\n        config.source = 'other';\n        config.term.write('连接关闭!\\r\\n请检查账号密码后刷新页面后重新连接！\\r\\n');\n      };\n    };\n    const onErrorSocket = () => {\n      config.ws.onerror = () => {\n        config.source = 'other';\n        config.term.write('连接失败!\\r\\n请检查账号密码后刷新页面后重新连接！\\r\\n');\n      };\n    };\n    const onMessageSocket = () => {\n      config.ws.onmessage = res => {\n        console.log(res);\n        config.source = 'other';\n        const msg = JSON.parse(res.data);\n        const term = config.term;\n        // console.log(\"receive: \" + data)\n        // 第一次连接成功将 initText 清空\n        if (config.first) {\n          config.first = false;\n          term.reset();\n          term.element && term.focus();\n          resizeRemoteTerminal();\n        }\n        term.write(b64_to_utf8(msg.data));\n      };\n    };\n    const getVmDetail = async () => {\n      try {\n        await new proxy.$request(proxy.$urls.m().vmdetail + \"?id=\" + config.id).modeget().then(rest => {\n          if (rest.data.code !== 200) {\n            new proxy.$tips(\"获取虚拟机详情失败\", \"warning\").notify();\n          }\n          formData.ip = rest.data.data.mgt_ip;\n          formData.pwd = rest.data.data.mgt_root_pwd;\n          document.getElementById('ddddd').click();\n        });\n        console.log(formData);\n      } catch (e) {\n        console.log(e);\n        if (e.code !== 401) {\n          new proxy.$tips(\"服务器错误，请稍后重试\", \"error\").notify();\n        }\n      }\n    };\n    const getServerDetail = async () => {\n      try {\n        await new proxy.$request(proxy.$urls.m().serverdetail + \"?id=\" + config.id).modeget().then(rest => {\n          if (rest.data.code !== 200) {\n            new proxy.$tips(\"获取服务器详情失败\", \"warning\").notify();\n          }\n          formData.ip = rest.data.data.mgt_ip;\n          formData.pwd = rest.data.data.mgt_root_pwd;\n        });\n      } catch (e) {\n        console.log(e);\n        if (e.code !== 401) {\n          new proxy.$tips(\"服务器错误，请稍后重试\", \"error\").notify();\n        }\n      }\n    };\n    return {\n      ...toRefs(config),\n      formData,\n      submitForm,\n      resetForm,\n      handleClick,\n      terminal,\n      getVmDetail,\n      rules,\n      formRef\n    };\n  }\n};","map":{"version":3,"names":["Terminal","FitAddon","debounce","getCurrentInstance","reactive","onBeforeUnmount","onUnmounted","onMounted","toRefs","ref","useRoute","setup","route","terminal","formRef","formData","user","pwd","ip","port","rules","required","message","trigger","pattern","removeResizeListener","config","term","dispose","ws","send","JSON","stringify","type","data","utf8_to_b64","source","query","id","getVmDetail","console","log","getServerDetail","isLoading","initWs","proxy","packResize","cols","rows","initText","first","fitAddon","socketUrl","$urls","m","option","lineHeight","cursorBlink","cursorStyle","fontSize","fontFamily","theme","background","foreground","cursor","selection","selectionForeground","initTerm","initSocket","onTerminalResize","onTerminalKeyPress","submitForm","validate","valid","fields","resetForm","formName","value","resetFields","handleClick","tab","event","name","rawString","btoa","unescape","encodeURIComponent","b64_to_utf8","encodeString","decodeURIComponent","escape","atob","bytesHuman","bytes","precision","test","units","num","Math","floor","pow","toFixed","isWsOpen","readyState","loadAddon","open","setTimeout","fit","onData","resizeRemoteTerminal","onResize","window","addEventListener","removeEventListener","write","WebSocket","onOpenSocket","onCloseSocket","onErrorSocket","_initialized","onMessageSocket","onopen","reset","onclose","onerror","onmessage","res","msg","parse","element","focus","$request","vmdetail","modeget","then","rest","code","$tips","notify","mgt_ip","mgt_root_pwd","document","getElementById","click","e","serverdetail"],"sources":["D:\\src\\github.com\\SecurityNeo\\cmdb-ui\\src\\page\\webssh\\webssh.vue"],"sourcesContent":["<template>\r\n  <div>\r\n      <div style=\"text-align: center;margin-top: 50px;\" v-show=\"source !== 'other'\">\r\n          <el-form ref=\"formRef\" :model=\"formData\" :rules=\"rules\" status-icon label-position=\"left\" label-width=\"80px\" style=\"margin-left: 50vh; width: 50vh\">\r\n            <el-form-item label=\"IP地址\" prop=\"ip\">\r\n              <el-input v-model=\"formData.ip\"/>\r\n            </el-form-item>\r\n            <el-form-item label=\"端口号\" prop=\"port\">\r\n              <el-input v-model=\"formData.port\"/>\r\n            </el-form-item>\r\n            <el-form-item label=\"用户名\" prop=\"user\">\r\n              <el-input v-model=\"formData.user\"/>\r\n            </el-form-item>\r\n            <el-form-item label=\"密码\" prop=\"pwd\">\r\n              <el-input v-model=\"formData.pwd\" type=\"password\" show-password/>\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button id=\"ddddd\" type=\"primary\" :loading=\"isLoading\" @click=\"submitForm(formRef)\">连接</el-button>\r\n              <el-button @click=\"resetForm(formRef)\">重置</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n        <div class=\"ssh-container\" ref=\"terminal\" v-show=\"source === 'other'\"></div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { Terminal } from 'xterm'\r\nimport { FitAddon } from 'xterm-addon-fit'\r\nimport 'xterm/css/xterm.css'\r\nimport { debounce } from 'lodash'\r\nimport { getCurrentInstance, reactive,onBeforeUnmount,onUnmounted,onMounted, toRefs,ref  } from 'vue'\r\nimport { useRoute } from 'vue-router';\r\n\r\nexport default {\r\n  setup() {\r\n    const route = useRoute()\r\n    const terminal = ref()\r\n\r\n    const formRef = ref()\r\n    \r\n    const formData = reactive( {\r\n        user: 'root',\r\n        pwd: '',\r\n        ip: '',\r\n        port: '22',\r\n    })\r\n    const rules = {\r\n        ip: [\r\n            { required: true, message: 'IP地址不能为空', trigger: 'blur' },\r\n            { pattern: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,message: '请输入正确IPV4地址',trigger: 'blur'}\r\n        ],\r\n        port: [\r\n            { required: true, message: '端口号不能为空', trigger: 'blur' },\r\n            { pattern: /^\\d*\\.?\\d+$/,message: '请输入正确端口号',trigger: 'blur'}\r\n        ],\r\n        user: [\r\n            { required: true, message: '用户名不能为空', trigger: 'blur' }\r\n        ],\r\n        pwd: [\r\n            { required: true, message: '用户名不能为空', trigger: 'blur' }\r\n        ],\r\n    }\r\n\r\n    onBeforeUnmount(()=>{\r\n      removeResizeListener()\r\n      config.term && config.term.dispose()\r\n      config.ws.send(JSON.stringify({\r\n        type: 'stdin',\r\n        data: utf8_to_b64('exit')\r\n      }))\r\n    })\r\n\r\n    onUnmounted(()=>{\r\n      config.ws.send(JSON.stringify({\r\n          type: 'stdin',\r\n          data: utf8_to_b64('exit')\r\n        }))\r\n    }) \r\n\r\n    onMounted(()=>{\r\n      \r\n      config.source = route.query.source\r\n      config.type = route.query.type\r\n      config.id = route.query.id\r\n\r\n      if (config.source === 'plat') {\r\n        if (config.type === 'vm') {\r\n          // 调用虚拟机详情接口查询登录信息\r\n          getVmDetail()\r\n          console.log(formData);\r\n          // 跳转过来不用再校验，直接登录\r\n          // config.isLoading = true\r\n          // initWs()    \r\n            \r\n        } else if ( config.type === 'server') {\r\n          // 调用物理机详情接口查询登录信息\r\n          getServerDetail()\r\n          // 跳转过来不用再校验，直接登录\r\n          config.isLoading = true\r\n          initWs() \r\n        }\r\n      }    \r\n    })\r\n    \r\n    const {proxy} = getCurrentInstance()\r\n    \r\n    const packResize = (cols, rows) =>\r\n      JSON.stringify({\r\n        type: 'resize',\r\n        cols: cols,\r\n        rows: rows\r\n    })\r\n\r\n    const config = reactive({\r\n      id: 0,\r\n      source: 'other',\r\n      type: '',\r\n      isLoading: false,\r\n      initText: '正在努力连接中...\\r\\n',\r\n      first: true,\r\n      term: null,\r\n      fitAddon: null,\r\n      ws: null,\r\n      socketUrl: proxy.$urls.m().ws,\r\n      option: {\r\n        lineHeight: 1.0,\r\n        // 光标闪烁\r\n        cursorBlink: true,\r\n        // 光标样式 'block' | 'underline' | 'bar'\r\n        cursorStyle: 'block', \r\n        // 字体大小\r\n        fontSize: 15,\r\n        // fontcolor: '#000000',\r\n        fontFamily: \"Monaco, Menlo, Consolas, 'Courier New', monospace\",\r\n        theme: {\r\n          // 背景色\r\n          background: '#002833',\r\n          // 前景色\r\n          foreground: '#14e264',\r\n          // 光标背景色\r\n          cursor: 'help',\r\n          // 光标前景色\r\n          /** The accent color of the cursor (fg color for a block cursor) */\r\n          // cursorAccent: '#000000',\r\n          // 选择背景色\r\n          /** The selection background color (can be transparent) */\r\n          selection: '#0000ff',\r\n          // 选择前景色\r\n          /** The selection foreground color */\r\n          selectionForeground: '#0000ff'\r\n        },\r\n        cols: 30 // 初始化的时候不要设置fit，设置col为较小值（最小为可展示initText初始文字即可）方便屏幕缩放\r\n      }\r\n    })\r\n\r\n    const initWs = ()=> {\r\n        initTerm()\r\n        initSocket()\r\n        onTerminalResize()\r\n        onTerminalKeyPress()\r\n    }\r\n\r\n    const submitForm = (formRef)=> {\r\n      //config.activeName = 'second'\r\n      formRef.validate((valid, fields) => {\r\n        if(valid) {\r\n          config.isLoading = true\r\n          initWs()\r\n        }\r\n      })\r\n    }\r\n\r\n    const resetForm = (formName)=> {\r\n        formName.value.resetFields();\r\n    }\r\n\r\n    const handleClick = (tab, event)=> {\r\n        if (tab.name === 'second') {\r\n          // this.init()\r\n        }\r\n    }\r\n\r\n    function utf8_to_b64(rawString) {\r\n        return btoa(unescape(encodeURIComponent(rawString)));\r\n    }\r\n\r\n    function b64_to_utf8(encodeString) {\r\n        return decodeURIComponent(escape(atob(encodeString)));\r\n    }\r\n\r\n    function  bytesHuman(bytes, precision) {\r\n        if (!/^([-+])?|(\\.\\d+)(\\d+(\\.\\d+)?|(\\d+\\.)|Infinity)$/.test(bytes)) {\r\n          return '-'\r\n        }\r\n        if (bytes === 0) return '0';\r\n        if (typeof precision === 'undefined') precision = 1;\r\n        const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB', 'BB'];\r\n        const num = Math.floor(Math.log(bytes) / Math.log(1024));\r\n        const value = (bytes / Math.pow(1024, Math.floor(num))).toFixed(precision);\r\n        return `${value} ${units[num]}`\r\n    }\r\n\r\n    function isWsOpen() {\r\n        return config.ws && config.ws.readyState === 1\r\n    }\r\n    \r\n    const initTerm = ()=> {\r\n        config.term = new Terminal(config.option)\r\n        config.fitAddon = new FitAddon()\r\n        config.term.loadAddon(config.fitAddon)\r\n        config.term.open(terminal.value)\r\n        // config.fitAddon.fit() // 初始化的时候不要使用fit\r\n        setTimeout(() => {\r\n          config.fitAddon.fit()\r\n        }, 500); // 必须延时处理\r\n    }\r\n\r\n    function onTerminalKeyPress() {\r\n        config.term.onData(data => {\r\n          isWsOpen() && config.ws.send(JSON.stringify({\r\n            type: 'stdin',\r\n            data: utf8_to_b64(data)\r\n          }))\r\n        })\r\n    }\r\n\r\n    function resizeRemoteTerminal() {\r\n        const { cols, rows } = config.term\r\n        console.log('列数、行数设置为：', cols, rows)\r\n        // 调整后端终端大小 使后端与前端终端大小一致\r\n        isWsOpen() && config.ws.send(packResize(cols, rows))\r\n      }\r\n    \r\n    const onResize = debounce(function () {\r\n        config.fitAddon.fit()\r\n      }, 100)\r\n  \r\n    function onTerminalResize() {\r\n        window.addEventListener('resize', onResize)\r\n        config.term.onResize(resizeRemoteTerminal)\r\n    }\r\n\r\n    function removeResizeListener() {\r\n        window.removeEventListener('resize', onResize)\r\n    }\r\n\r\n    const initSocket = ()=> {\r\n        config.term.write(config.initText)\r\n        console.log(config.socketUrl)\r\n        config.ws = new WebSocket(config.socketUrl,['webssh'])\r\n        onOpenSocket()\r\n        onCloseSocket()\r\n        onErrorSocket()\r\n        config.term._initialized = true\r\n        onMessageSocket()\r\n    }\r\n\r\n    const onOpenSocket = ()=> {\r\n        config.ws.onopen = () => {\r\n          console.log('websocket 已连接')\r\n          config.ws.send(JSON.stringify({ type: \"addr\", data: utf8_to_b64(formData.ip + ':' + formData.port) }));\r\n          // socket.send(JSON.stringify({ type: \"term\", data: utf8_to_b64(\"linux\") }));\r\n          config.ws.send(JSON.stringify({ type: \"login\", data: utf8_to_b64(formData.user) }));\r\n          config.ws.send(JSON.stringify({ type: \"password\", data: utf8_to_b64(formData.pwd) }));\r\n          config.term.reset()\r\n          setTimeout(() => {\r\n            resizeRemoteTerminal()\r\n          }, 500)\r\n        }\r\n    }\r\n\r\n    const onCloseSocket =()=> {\r\n        config.ws.onclose = () => {\r\n          console.log('关闭连接')\r\n          config.source = 'other'\r\n          config.term.write('连接关闭!\\r\\n请检查账号密码后刷新页面后重新连接！\\r\\n');\r\n        }\r\n    }\r\n    \r\n    const onErrorSocket =()=> {\r\n        config.ws.onerror = () => {\r\n          config.source = 'other'\r\n          config.term.write('连接失败!\\r\\n请检查账号密码后刷新页面后重新连接！\\r\\n')\r\n        }\r\n    }\r\n\r\n    const onMessageSocket = ()=> {\r\n        config.ws.onmessage = res => {\r\n          console.log(res)\r\n          config.source = 'other'\r\n          const msg = JSON.parse(res.data)\r\n          const term = config.term\r\n          // console.log(\"receive: \" + data)\r\n          // 第一次连接成功将 initText 清空\r\n          if (config.first) {\r\n            config.first = false\r\n            term.reset()\r\n            term.element && term.focus()\r\n            resizeRemoteTerminal()\r\n          }\r\n          term.write(b64_to_utf8(msg.data))\r\n        }\r\n    }\r\n\r\n\r\n    const getVmDetail = async()=> {\r\n        try {\r\n            await new proxy.$request(proxy.$urls.m().vmdetail + \"?id=\" + config.id).modeget()\r\n            .then(rest=>{\r\n                if (rest.data.code !== 200 ) {\r\n                  new proxy.$tips(\"获取虚拟机详情失败\", \"warning\").notify()\r\n                }\r\n                formData.ip = rest.data.data.mgt_ip\r\n                formData.pwd =  rest.data.data.mgt_root_pwd\r\n                document.getElementById('ddddd').click();\r\n                \r\n            })\r\n            console.log(formData);\r\n                  \r\n        } catch (e) {\r\n            console.log(e);\r\n            if (e.code !== 401) {\r\n                new proxy.$tips(\"服务器错误，请稍后重试\", \"error\").notify()\r\n            }     \r\n        }\r\n    }\r\n\r\n    const getServerDetail = async()=> {\r\n        try {\r\n            await new proxy.$request(proxy.$urls.m().serverdetail + \"?id=\" + config.id).modeget()\r\n            .then(rest=>{\r\n              if (rest.data.code !== 200 ) {\r\n                  new proxy.$tips(\"获取服务器详情失败\", \"warning\").notify()\r\n                }\r\n                formData.ip = rest.data.data.mgt_ip\r\n                formData.pwd =  rest.data.data.mgt_root_pwd  \r\n            })           \r\n        } catch (e) {\r\n            console.log(e);\r\n            if (e.code !== 401) {\r\n                new proxy.$tips(\"服务器错误，请稍后重试\", \"error\").notify()\r\n            }     \r\n        }\r\n    }\r\n\r\n    return {\r\n      ...toRefs(config),\r\n      formData,\r\n      submitForm,\r\n      resetForm,\r\n      handleClick,\r\n      terminal,\r\n      getVmDetail,\r\n      rules,\r\n      formRef\r\n    }\r\n\r\n  }\r\n}\r\n\r\n</script>\r\n<style lang=\"scss\">\r\nbody {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.ssh-container {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  overflow: hidden;\r\n  height: 100vh;\r\n  border-radius: 4px;\r\n  background: rgb(255, 255, 255);\r\n  padding: 0px;\r\n  //color: rgb(0, 0, 0);\r\n\r\n  .xterm-scroll-area::-webkit-scrollbar-thumb {\r\n    background-color: #b7c4d1;\r\n    /* 滚动条的背景颜色 */\r\n  }\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}