{"ast":null,"code":"import { reactive, toRefs, getCurrentInstance, ref } from 'vue';\nimport { Base64 } from 'js-base64';\nexport default {\n  setup() {\n    const user = reactive({\n      account: \"\",\n      name_alias: \"\",\n      password: \"\",\n      re_password: \"\",\n      mail: \"\",\n      phone: \"\"\n    });\n    const addUserRef = ref();\n    const rules = {\n      account: [{\n        required: true,\n        message: '用户名不能为空',\n        trigger: 'blur'\n      }, {\n        pattern: /^[a-zA-Z0-9_]+$/,\n        message: '只能输入字母、数字和下划线',\n        trigger: 'blur'\n      }],\n      phone: [{\n        pattern: /^[1][0-9]{10}$/,\n        message: '请输入正确手机号码',\n        trigger: 'blur'\n      }]\n    };\n    const config = reactive({\n      centerDialogVisible: false,\n      isLoading: false\n    });\n    const {\n      proxy\n    } = getCurrentInstance();\n    const addUser = async addUserRef => {\n      const obj = {\n        username: user.account,\n        name_alias: user.name_alias,\n        password: Base64.encode(user.password),\n        mail: user.mail,\n        phone: user.phone,\n        role: \"user\"\n      };\n      await addUserRef.validate((valid, fields) => {\n        if (valid) {\n          config.isLoading = true;\n          const rest = new proxy.$request(proxy.$urls.m().useradd, obj).modepost();\n          if (rest.data.code !== 200) {\n            new proxy.$tips(\"创建用户失败，稍后重试\", \"error\").notify();\n          }\n          config.isLoading = false;\n          config.centerDialogVisible = false;\n          proxy.$emit('flushPage');\n        }\n      });\n    };\n\n    // 被父组件user.vue调用\n    function addUserDialog() {\n      config.centerDialogVisible = true;\n    }\n    return {\n      user,\n      rules,\n      config,\n      addUser,\n      addUserDialog,\n      addUserRef\n    };\n  }\n};","map":{"version":3,"names":["reactive","toRefs","getCurrentInstance","ref","Base64","setup","user","account","name_alias","password","re_password","mail","phone","addUserRef","rules","required","message","trigger","pattern","config","centerDialogVisible","isLoading","proxy","addUser","obj","username","encode","role","validate","valid","fields","rest","$request","$urls","m","useradd","modepost","data","code","$tips","notify","$emit","addUserDialog"],"sources":["D:\\src\\github.com\\SecurityNeo\\cmdb-ui\\src\\page\\system\\components\\adduser-dialog.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-dialog\r\n            v-model=config.centerDialogVisible\r\n            title=\"新建用户\"\r\n            width=\"30%\"\r\n            align-center\r\n            :close-on-click-modal=\"false\"            \r\n        >\r\n        <div>\r\n            <div style=\"margin-right: 72px\">\r\n                <el-form\r\n                    ref=\"addUserRef\"\r\n                    :model=\"user\"\r\n                    :rules=\"rules\"\r\n                    label-width=\"120px\"\r\n                    status-icon\r\n                >\r\n                    <el-form-item label=\"用户名\" prop=\"account\">\r\n                        <el-input v-model=\"user.account\"  clearable class=\"inputflex\"  placeholder=\"请输入用户名\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"姓名\" prop=\"name_alias\">\r\n                        <el-input v-model=\"user.name_alias\" clearable class=\"inputflex\"  placeholder=\"请输入姓名\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"密码\" prop=\"password\">\r\n                        <el-input v-model=\"user.password\" clearable class=\"inputflex\" type=\"password\" placeholder=\"请输入密码\" show-password />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"确认密码\" prop=\"re_password\">\r\n                        <el-input v-model=\"user.re_password\" clearable class=\"inputflex\" type=\"password\" placeholder=\"请确认密码\" show-password />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"电子邮箱\" prop=\"mail\">\r\n                        <el-input v-model=\"user.mail\" clearable class=\"inputflex\"  placeholder=\"请输入电子邮箱\"  />\r\n                    </el-form-item>\r\n                    <el-form-item label=\"电话号码\" prop=\"phone\">\r\n                        <el-input v-model=\"user.phone\" clearable class=\"inputflex\"  placeholder=\"请输入电话号码\"  />\r\n                    </el-form-item>\r\n                </el-form>\r\n            </div>\r\n            <div>         \r\n                <div style=\"float: right; margin-bottom: 40px; margin-right: 72px;margin-top: 20px;\">\r\n                    <el-button @click=\"config.centerDialogVisible = false\">取消</el-button>\r\n                    <el-button type=\"primary\" :loading=\"config.isLoading\" @click=\"addUser(addUserRef)\" >确认</el-button>\r\n                </div>                    \r\n            </div>\r\n        </div>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport {reactive, toRefs, getCurrentInstance, ref} from 'vue'\r\nimport { Base64 } from 'js-base64'\r\n\r\nexport default {\r\n    setup() {\r\n        const user = reactive({\r\n            account: \"\",\r\n            name_alias: \"\",\r\n            password: \"\",\r\n            re_password: \"\",\r\n            mail: \"\",\r\n            phone: \"\"\r\n        })\r\n\r\n        const addUserRef = ref()         \r\n\r\n        const rules = {\r\n            account: [\r\n                { required: true, message: '用户名不能为空', trigger: 'blur' },\r\n                { pattern: /^[a-zA-Z0-9_]+$/, message: '只能输入字母、数字和下划线', trigger: 'blur' }\r\n            ],\r\n            phone: [\r\n                {pattern: /^[1][0-9]{10}$/,message: '请输入正确手机号码',trigger: 'blur'}\r\n            ]\r\n        }\r\n\r\n        const config = reactive({\r\n            centerDialogVisible: false,\r\n            isLoading: false\r\n        })\r\n\r\n        const {proxy} = getCurrentInstance()\r\n        const addUser = async(addUserRef) => {\r\n            const obj = {\r\n                username: user.account,\r\n                name_alias: user.name_alias,\r\n                password: Base64.encode(user.password),\r\n                mail: user.mail,\r\n                phone: user.phone,\r\n                role: \"user\"\r\n            }\r\n            await addUserRef.validate((valid, fields) => {\r\n                if (valid) {\r\n                    config.isLoading = true\r\n                    const rest =  new proxy.$request(proxy.$urls.m().useradd, obj).modepost()\r\n                    if (rest.data.code !== 200) {\r\n                        new proxy.$tips(\"创建用户失败，稍后重试\", \"error\").notify()\r\n                    }\r\n                    config.isLoading = false\r\n                    config.centerDialogVisible = false\r\n                    proxy.$emit('flushPage')\r\n                }\r\n            })\r\n\r\n        }\r\n\r\n        // 被父组件user.vue调用\r\n        function addUserDialog() {\r\n            config.centerDialogVisible = true\r\n        }\r\n\r\n        return {\r\n            user, \r\n            rules,\r\n            config, \r\n            addUser,\r\n            addUserDialog,\r\n            addUserRef\r\n        }\r\n    }\r\n}\r\n</script>"],"mappings":"AAkDA,SAAQA,QAAQ,EAAEC,MAAM,EAAEC,kBAAkB,EAAEC,GAAG,QAAO,KAAI;AAC5D,SAASC,MAAK,QAAS,WAAU;AAEjC,eAAe;EACXC,KAAKA,CAAA,EAAG;IACJ,MAAMC,IAAG,GAAIN,QAAQ,CAAC;MAClBO,OAAO,EAAE,EAAE;MACXC,UAAU,EAAE,EAAE;MACdC,QAAQ,EAAE,EAAE;MACZC,WAAW,EAAE,EAAE;MACfC,IAAI,EAAE,EAAE;MACRC,KAAK,EAAE;IACX,CAAC;IAED,MAAMC,UAAS,GAAIV,GAAG,CAAC;IAEvB,MAAMW,KAAI,GAAI;MACVP,OAAO,EAAE,CACL;QAAEQ,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAO,CAAC,EACvD;QAAEC,OAAO,EAAE,iBAAiB;QAAEF,OAAO,EAAE,eAAe;QAAEC,OAAO,EAAE;MAAO,EAC3E;MACDL,KAAK,EAAE,CACH;QAACM,OAAO,EAAE,gBAAgB;QAACF,OAAO,EAAE,WAAW;QAACC,OAAO,EAAE;MAAM;IAEvE;IAEA,MAAME,MAAK,GAAInB,QAAQ,CAAC;MACpBoB,mBAAmB,EAAE,KAAK;MAC1BC,SAAS,EAAE;IACf,CAAC;IAED,MAAM;MAACC;IAAK,IAAIpB,kBAAkB,CAAC;IACnC,MAAMqB,OAAM,GAAI,MAAMV,UAAU,IAAK;MACjC,MAAMW,GAAE,GAAI;QACRC,QAAQ,EAAEnB,IAAI,CAACC,OAAO;QACtBC,UAAU,EAAEF,IAAI,CAACE,UAAU;QAC3BC,QAAQ,EAAEL,MAAM,CAACsB,MAAM,CAACpB,IAAI,CAACG,QAAQ,CAAC;QACtCE,IAAI,EAAEL,IAAI,CAACK,IAAI;QACfC,KAAK,EAAEN,IAAI,CAACM,KAAK;QACjBe,IAAI,EAAE;MACV;MACA,MAAMd,UAAU,CAACe,QAAQ,CAAC,CAACC,KAAK,EAAEC,MAAM,KAAK;QACzC,IAAID,KAAK,EAAE;UACPV,MAAM,CAACE,SAAQ,GAAI,IAAG;UACtB,MAAMU,IAAG,GAAK,IAAIT,KAAK,CAACU,QAAQ,CAACV,KAAK,CAACW,KAAK,CAACC,CAAC,CAAC,CAAC,CAACC,OAAO,EAAEX,GAAG,CAAC,CAACY,QAAQ,CAAC;UACxE,IAAIL,IAAI,CAACM,IAAI,CAACC,IAAG,KAAM,GAAG,EAAE;YACxB,IAAIhB,KAAK,CAACiB,KAAK,CAAC,aAAa,EAAE,OAAO,CAAC,CAACC,MAAM,CAAC;UACnD;UACArB,MAAM,CAACE,SAAQ,GAAI,KAAI;UACvBF,MAAM,CAACC,mBAAkB,GAAI,KAAI;UACjCE,KAAK,CAACmB,KAAK,CAAC,WAAW;QAC3B;MACJ,CAAC;IAEL;;IAEA;IACA,SAASC,aAAaA,CAAA,EAAG;MACrBvB,MAAM,CAACC,mBAAkB,GAAI,IAAG;IACpC;IAEA,OAAO;MACHd,IAAI;MACJQ,KAAK;MACLK,MAAM;MACNI,OAAO;MACPmB,aAAa;MACb7B;IACJ;EACJ;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}